<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Training Module - Martinsville CDL / ELDT</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen p-4 bg-gray-50">
  <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6">
    <h1 id="moduleTitle" class="text-xl font-bold mb-4 text-center">
      Training Module
    </h1>

    <!-- YouTube video -->
    <div class="aspect-w-16 aspect-h-9 mb-6">
      <iframe id="trainingVideo" class="w-full h-96 rounded-lg"
        src="https://www.youtube.com/embed/YOUR_VIDEO_ID?enablejsapi=1&controls=1"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>

    <!-- Complete button -->
    <button id="completeBtn" disabled
      class="btn bg-gray-400 text-white py-2 px-4 rounded-lg w-full">
      Mark Complete
    </button>
  </div>

  <!-- Load YouTube API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    let player;
    let maxWatched = 0;
    let duration = 0;
    const completeBtn = document.getElementById('completeBtn');

    // Called when the YouTube API is ready
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('trainingVideo', {
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      duration = player.getDuration();
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        setInterval(() => {
          const current = player.getCurrentTime();

          // Prevent skipping forward
          if (current - maxWatched > 2) {
            player.seekTo(maxWatched);
          } else {
            maxWatched = Math.max(maxWatched, current);
          }

          // Unlock button when 98% of video watched
          if (maxWatched >= duration * 0.98) {
            completeBtn.disabled = false;
            completeBtn.classList.remove('bg-gray-400');
            completeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
          }
        }, 1000);
      }
    }

    completeBtn.addEventListener('click', () => {
      alert("âœ… Module marked complete!");
      // You can add code here to record completion in Google or your database
    });
  </script>
</body>
</html>
